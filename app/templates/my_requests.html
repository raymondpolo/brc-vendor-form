{% extends "layout.html" %}
{% from 'partials/_request_card.html' import request_card %}

{% block content %}
<div class="bg-white p-6 rounded-lg shadow-md" x-data="requestManager()">
    <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold text-gray-700">My Submitted Requests</h3>
        <a href="{{ url_for('main.new_request') }}" class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700">
            Create New Request
        </a>
    </div>

    <div class="mb-4">
        <input type="text" x-model="search" placeholder="Search across all columns..."
               class="w-full md:w-1/2 lg:w-1/3 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <template x-for="req in filteredRequests" :key="req.id">
            {{ request_card('req') }}
        </template>
    </div>

    <div x-show="filteredRequests.length === 0" class="text-center text-gray-500 py-10">
        No requests found matching your search.
    </div>
</div>

<script>
    function requestManager() {
        return {
            search: '',
            requests: {{ requests_json|safe }},

            get filteredRequests() {
                const searchLower = this.search.toLowerCase();
                if (!searchLower) {
                    return this.requests;
                }
                return this.requests.filter(req => {
                    return Object.values(req).some(val =>
                        String(val).toLowerCase().includes(searchLower)
                    );
                });
            }
        }
    }
</script>
{% endblock content %}